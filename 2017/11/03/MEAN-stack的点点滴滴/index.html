<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dreamhuan.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一个简单的关于MEAN.js的分享（入门教程）">
<meta property="og:type" content="article">
<meta property="og:title" content="MEAN stack的点点滴滴">
<meta property="og:url" content="https://dreamhuan.github.io/2017/11/03/MEAN-stack%E7%9A%84%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4/index.html">
<meta property="og:site_name" content="梦幻">
<meta property="og:description" content="一个简单的关于MEAN.js的分享（入门教程）">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-11-03T02:11:35.000Z">
<meta property="article:modified_time" content="2024-11-08T07:32:34.542Z">
<meta property="article:author" content="dreamhuan">
<meta property="article:tag" content="MEAN">
<meta property="article:tag" content="Nodejs">
<meta property="article:tag" content="AngularJS">
<meta property="article:tag" content="Express">
<meta property="article:tag" content="MongoDB">
<meta property="article:tag" content="front-end">
<meta property="article:tag" content="back-end">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://dreamhuan.github.io/2017/11/03/MEAN-stack%E7%9A%84%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MEAN stack的点点滴滴 | 梦幻</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?dcb9d86bbbbb71dcf296a6a21af4c886";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">梦幻</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">dreamhuan</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dreamhuan.github.io/2017/11/03/MEAN-stack%E7%9A%84%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/dreamhuan.jpg">
      <meta itemprop="name" content="dreamhuan">
      <meta itemprop="description" content="萌新求带">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="梦幻">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MEAN stack的点点滴滴
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-11-03 10:11:35" itemprop="dateCreated datePublished" datetime="2017-11-03T10:11:35+08:00">2017-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-08 15:32:34" itemprop="dateModified" datetime="2024-11-08T15:32:34+08:00">2024-11-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MEAN/" itemprop="url" rel="index"><span itemprop="name">MEAN</span></a>
                </span>
            </span>

          
            <span id="/2017/11/03/MEAN-stack%E7%9A%84%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4/" class="post-meta-item leancloud_visitors" data-flag-title="MEAN stack的点点滴滴" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/11/03/MEAN-stack%E7%9A%84%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/11/03/MEAN-stack的点点滴滴/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>一个简单的关于MEAN.js的分享（入门教程）</p>
<span id="more"></span>

<hr>
<h1 id="总览"><a href="#总览" class="headerlink" title="总览"></a>总览</h1><p>写在前面：<br>Angular自从出2.x版本后1.x就统称为Angularjs，2以及后面的版本称为Angular<br>另外Angularjs将在未来停止更新，本文基于Angularjs，所以前端部分的写法不用深究，其他内容换成Angular后也可以使用。</p>
<h2 id="MEAN-js简介"><a href="#MEAN-js简介" class="headerlink" title="MEAN.js简介"></a>MEAN.js简介</h2><p><strong>MEAN</strong>是一个以JavaScript语言主导的web开发技术栈。是MongoDB、Express、AngularJS、Nodejs的首字母缩写的组合。前端部分为Google提供的开源框架AngularJS（2.0开始做了不兼容升级并改名为Angular，这里以AngularJS为例，因为我们实验室主导项目基于AngularJS的，还没完成升级。）后端部分用Nodejs自带的http模块开启一个服务器，并用Express框架提供的中间件设计完成后端逻辑。其中数据持久化使用了一种noSQL数据库MongoDB。</p>
<p><strong>AngularJS</strong>是一个前端MVC框架，主要用于做单页应用（SPA，Single Page Application）。单页应用，顾名思义就是只有一个页面，里面所有的内容都是通过js动态请求数据并动态修改HTML的DOM实现的。</p>
<p><strong>Nodejs</strong>是JavaScript的一个运行环境，由Google的V8引擎提供了js解析，让js可以脱离浏览器运行，并提供了一些系统api比如文件读写（fs模块），内置了一个http模块提供服务器支持（C++编写，效率保证）我们要使用它需要安装，网上可以找到安装程序，装完后可以通过<code>node -v</code>查看版本</p>
<p><strong>Express</strong>是后端框架，作为Nodejs http模块的server中间件处理分发请求。</p>
<p><strong>MongoDB</strong>是文档型数据库，内部数据为json结构，不用再进行对象的二次转换，使用很方便，效率也蛮高，比较适合数据变化较大，数据结构较复杂的网页。</p>
<p>以上只是极简单的介绍，详情可以自行参考各框架的官网~</p>
<h2 id="以一个小项目为例"><a href="#以一个小项目为例" class="headerlink" title="以一个小项目为例"></a>以一个小项目为例</h2><p>接下来以一个时间表小项目为例，记录下从０开始的编码过程。这个项目主要用于记录一周７天ｘ上午下午晚上３个时间段的空闲时间（实验室要求每个人规划自己的空闲时间提交来实验室的时间）。核心就两个模块，时间表模块和用户模块。时间表就增改查，用户就登录注册。出于演示所有功能逻辑都只是一个雏形．．．<br>然后说一下我的环境，为了适应生产环境，我本地环境是node6.10.0，npm3.10.10至于npm是啥下文会讲。</p>
<hr>
<h1 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h1><h2 id="Nodejs建立服务器"><a href="#Nodejs建立服务器" class="headerlink" title="Nodejs建立服务器"></a>Nodejs建立服务器</h2><p>首先提一下模块系统，我们自己开发的网页会用到很多别人写的库或者框架，要是全部以源码方式交流（git等方式团队合作）代码文件就很大，而且满大街找别人写好的东西也很累是不（笑），所以就有了模块系统也就是npm这个东西。在安装完nodejs后npm也一起装完了，npm就是一个nodejs的模块管理工具，官方一点就是包管理器。你需要下载一个什么东西直接<code>npm install xxx</code>就好了，是不是超级方便，执行完后当前目录下（当前目录就是你命令行执行那个命令的目录，“&gt;”左边那个东西，windows下按win+r输入cmd就打开了命令行，默认在用户目录“<code>C:\Users\你的用户名</code>”）就会有一个<code>node_modules</code>文件夹，下载的所有库都会在那里面。那么要是团队合作怎么知道我装了什么库呢？一般人都能想到，写一个文件记录装的库名字和版本号不就行啦，这就是<code>package.json</code>文件。当然package.json文件记录了更多的信息，比如项目名字，作者，开源协议等稍后再细讲。</p>
<p>好了进入正题。win+r输入cmd进入命令行(一个黑框框)，输入<code>cd Desktop</code>回车，工作路径切换到桌面（下文“执行xxx”就表示命令行输入命令后回车）执行<code>mkdir timetable</code>，桌面会新建一个timetable文件夹。执行<code>cd timetable</code>，<code>npm init</code>，然后会问我们好多问题，暂时全部保持默认一路回车（之后再改）。最后出现Is this ok? (yes)回车之后timetable文件夹就出现了package.json文件。我的文件长这样</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timetable&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>当然刚刚那一堆命令也不用那么烦，你完全可以把上面这段代码复制，本地保存为package.json然后新建个timetable文件夹吧package.json扔里面，效果完全一样。</p>
<p>package.json是nodejs项目的模块配置文件，执行npm相关命令的时候都会读取或者写入这个文件，上文提到的把依赖的库名称和版本号记录下来也是在这个文件里面。<br>在timetable文件夹下新建<a href="http://www.js,编写如下代码/">www.js，编写如下代码</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">write</span>(<span class="string">&#x27;hello nodejs&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure>

<p>回到命令行（希望你没有关，关了也没事，打开timetable文件夹，在不选中任何文件的情况下按住shift后按鼠标右键会发现右键菜单多了“在此处打开命令窗口”的选项，也可能是“在此处打开powershell窗口”…win10不太一样，点一下就打开在timetable目录的命令行了，当然你要通过cd切换我也没意见）执行<code>node www</code>，然后打开浏览器输入<code>http://localhost:8080</code>就可以看到输出了。这样就用nodejs很简单的建立了一个本地服务器，监听8080端口。</p>
<h2 id="后端基本结构"><a href="#后端基本结构" class="headerlink" title="后端基本结构"></a>后端基本结构</h2><p>这样虽然开启了了服务器，并且也可以成功收到请求了，但是若是所有的请求都在一个函数里面执行逻辑，比如判断请求参数调用不同函数，那将是一个灾难（虽然用一个map似乎也不是不可以，但是我们有更好的方案）。然后执行<code>npm i --save express</code>引入<code>express</code>框架（如果你的命令行正在执行node你可以选择<code>ctrl+c</code>终止或者另外再开一个命令行）。这里i就是install的缩写，<code>--save</code>就表示吧这个库连同版本号一起写入package.json文件中。下载完依赖后打开package.json，会发现多了</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;express&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.16.2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这就记录了这个项目依赖<code>express</code>这个框架（库），版本号为4.16.2。这样会安装最新版本，如果要装确定的版本，就在库名后面加上@版本号就行了比如<code>npm i --save express@4.0.0</code>（这个版本号瞎编的，实际中需要去官网看需要哪个版本），别人拿到项目后也不用一个个<code>npm i xxx</code>了可以直接运行<code>npm i</code>，npm会读取<code>package.json</code>文件里含有<code>dependencies</code>字段的内容并全部下载（除了dependencies，常用的还有devDependencies等，区别后面会讲）</p>
<p>好了我们继续，打开并修改<a href="http://www.js文件(加了相关注释)/">www.js文件（加了相关注释）</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入http模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 引入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 实例化express</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 用express的实例app创建一个服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(app);</span><br><span class="line"><span class="comment">// 监听8080端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br><span class="line"><span class="comment">// 监听对根目录的get请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello express&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>重启下服务器（ctrl+c终止后按↑就可以看到历史命令，找到node www后回车）每次对代码进行修改都要重启下服务器让内的代码进入内存（node会吧代码放到缓存，从缓存读取）然后刷新下浏览器，应该可以看到效果了，为了区分我把hello nodejs改成输出hello express。对比下两个<a href="http://www.js文件,其实就是`createserver`函数的参数用express的实例app代替了,而后面加了个app.get函数用于处理对“/%E2%80%9D%E7%9A%84get%E8%AF%B7%E6%B1%82%E3%80%82%E8%87%B3%E4%BA%8Eget%E8%AF%B7%E6%B1%82%E5%95%A5%E6%84%8F%E6%80%9D%E5%BB%BA%E8%AE%AE%E8%A1%A5%E4%B8%80%E4%B8%8Bhttp%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%EF%BC%88%E6%89%BE%E5%87%A0%E7%AF%87%E5%8D%9A%E5%AE%A2%E7%9C%8B%E4%B8%80%E4%B8%8B%E5%B0%B1%E5%A5%BD%EF%BC%89">www.js文件，其实就是`createServer`函数的参数用express的实例app代替了，而后面加了个app.get函数用于处理对“/”的get请求。至于get请求啥意思建议补一下http协议相关内容（找几篇博客看一下就好）</a></p>
<p>有了这个就方便多了，我们可以简单的往下加app.get或者post来处理不同的请求。<a href="http://www.js文件最后面加上/">www.js文件最后面加上</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/timetable&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;timetable&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>重启node服务后访问<code>localhost:8080/user</code>和<code>localhost:8080/timetable</code>就可以看到效果了。然后是不是觉得重启每次改完代码都要重启下服务很烦？那就需要一些工具了。命令行执行<code>npm i --save-dev supervisor</code>。这回出现了个新东西<code>--save-dev</code>这个和上面出现过的<code>--save</code>是差不多的，只不过这样就把依赖写入package.json的devDependencies字段里面，表示这个依赖开发的时候才用得到，生产环境不需要。这样生产环境执行<code>npm install --production</code>就不会下载安装devDependencies下的东西。此时package.json文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timetable&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;express&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.16.2&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;supervisor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.12.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这时候就可以使用<code>supervisor www</code>代替<code>node www</code>了，supervisor会自动监听文件，有改动就自动重启。然后我们发现supervisor这个单词好长，教练，有没有简单的命令？当然有。package.json有一个scripts字段，目前里面只有<code>&quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</code>，我们加上<code>&quot;start&quot;: &quot;supervisor www&quot;,</code>，现在package.json的scripts变成了这样</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;supervisor www&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>然后就可以用<code>npm run start</code>代替<code>supervisor www</code>命令了，然后npm对start做了简化可以直接写<code>npm start</code>（具体关于这部分内容可以看<a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html">这里</a>），好了我们执行<code>npm start</code></p>
<p>继续。随着项目变大，代码全部写在www文件会导致文件越来越大。是时候做一波代码分离了。首先吧app和www分离，后续代码基本不会修改www里面的内容了，就是app内容的修改（多写几个app.get等…)好，首先新建个app.js并把<code>www.js</code>里面关于app的代码分离出去，然后新建个bin文件夹，表示可执行目录，并把<a href="http://www.js文件拖进去,之后所有可执行文件都会放在bin目录(有些项目会有定时任务啥的要单独执行)/">www.js文件拖进去，之后所有可执行文件都会放在bin目录（有些项目会有定时任务啥的要单独执行）</a>…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 实例化express</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello express&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/timetable&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;timetable&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bin/www.js</span></span><br><span class="line"><span class="comment">// 引入http模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 引入app模块</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">&#x27;../app&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用express的实例app创建一个服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(app);</span><br><span class="line"><span class="comment">// 监听8080端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure>

<p>解释一下，这里把app相关的代码分离到了app.js，<a href="http://www.js的app就引入(因为app在父目录所以是`../app.js%60%EF%BC%89%E5%B0%B1%E5%A5%BD%E4%BA%86%E3%80%82%E7%84%B6%E5%90%8E%E5%9B%A0%E4%B8%BA%E8%A6%81%E6%8F%90%E4%BE%9B%E7%BB%99www%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5%E6%89%80%E4%BB%A5app%E6%96%87%E4%BB%B6%E6%9C%80%E5%90%8E%E4%B8%80%E8%A1%8C%60module.exports">www.js的app就引入（因为app在父目录所以是`../app.js`）就好了。然后因为要提供给www文件引入所以app文件最后一行`module.exports</a> &#x3D; app;&#96;就表示把app模块导出（这里是CommonJS规范的模块语法）。<br>然后我们对bin&#x2F;<a href="http://www.js文件做最后的改动，把端口号定义成常量然后server绑定了listening和error事件（用于报告错误，具体事件代码我是直接复制IDEA生成的express项目代码的）：">www.js文件做最后的改动，把端口号定义成常量然后server绑定了listening和error事件（用于报告错误，具体事件代码我是直接复制IDEA生成的express项目代码的）：</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bin/www.js</span></span><br><span class="line"><span class="comment">// 引入http模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 引入app模块</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">&#x27;../app&#x27;</span>);</span><br><span class="line"><span class="comment">// 定义端口常量</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8080</span>;</span><br><span class="line"><span class="comment">// 用express的实例app创建一个服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(app);</span><br><span class="line"><span class="comment">// 监听8080端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>);</span><br><span class="line"><span class="comment">// 绑定成功监听端口事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;connect to port &#x27;</span> + <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 绑定错误事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">syscall</span> !== <span class="string">&#x27;listen&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> bind = <span class="keyword">typeof</span> port === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">        ? <span class="string">&#x27;Pipe &#x27;</span> + port</span><br><span class="line">        : <span class="string">&#x27;Port &#x27;</span> + port;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (error.<span class="property">code</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;EACCES&#x27;</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(bind + <span class="string">&#x27; requires elevated privileges&#x27;</span>);</span><br><span class="line">            process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;EADDRINUSE&#x27;</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(bind + <span class="string">&#x27; is already in use&#x27;</span>);</span><br><span class="line">            process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后我们可以不用管www文件了。把重点放到app文件，首先就是那几个app.get。之前演示已经知道了这个是绑定路由，根据前端请求的路径执行不同的函数实现后端数据处理逻辑。那么当项目越来越大以后，这样子的函数就会越来越多，都放到app.js显然不是很合适，是时候做一波路由分离了（这个名词我瞎编的0.0）</p>
<p>首先新建一个<code>routes</code>文件夹里面再新建<code>index.js</code>，<code>user.js</code>，<code>timetable.js</code>。然后把app.get相关代码转移过去。那么问题来了，怎么转移？之前把app从www转移是因为app完全是分离的代码，www里面的app可以导入app并且没有别的操作了。然而我们这里要把app.get转移出去的话index.js文件里面的app的确也可以导入，但是在routes&#x2F;index.js文件写好的代码怎么导入到app.js文件呢？直接require么？那不是循环依赖了（routes&#x2F;index.js require app，app.js又require routes&#x2F;index.js）一个可行的方案是routes&#x2F;index.js导出一个可执行函数并接受app作为参数，在app.js里面直接require并执行。示例代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello express&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>改成这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>)(app);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/index.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">app</span>) &#123;</span><br><span class="line">    app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;hello express&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这么做的缺点这是把app整个根模块暴露给了项目的子模块，就有可能造成app模块的滥用导致影响别的代码，或者说，增强了模块的耦合。<br>不过在express4.x开始引入了一个Router，于是分离路由有了新方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello express&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>改成这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> index = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, index);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello express&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>这两种方式没什么本质的区别，app本质上也只是一个router而已，这里用了express.Router挂载路由，后面的get啊post啊都加到router上面，独立了一个路由的实例，具体有什么好处可以查看这篇文章<a href="http://lostjs.com/2014/04/24/router-in-express-4/">浅谈 Express 4.0 Router 模块</a>。这里有个地方需要注意的，现在无论app.get还是app.use还是router.get第一个参数都是“&#x2F;”，看不出啥问题，但是要是换成“&#x2F;user”就有区别了。下文细讲<br>完整的分离后的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 实例化express</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 引入别的路由模块</span></span><br><span class="line"><span class="keyword">const</span> index = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = <span class="built_in">require</span>(<span class="string">&#x27;./routes/user&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> timetable = <span class="built_in">require</span>(<span class="string">&#x27;./routes/timetable&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, index);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/user&#x27;</span>, user);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/timetable&#x27;</span>, timetable);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello express&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/timetable.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;timetable&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>首先会发现<code>index.js</code>，<code>timetable.js</code>，<code>user.js</code>三个文件内部的get第一个参数都是“&#x2F;”而不是“&#x2F;user”啥的。看<code>app.js</code>用了app.use。就是使用中间件，具体这个啥意思目前可以理解为对第一个参数的路由的请求都由第二个参数的模块处理，比如<code>app.use(&#39;/user&#39;,user)</code>表示对<code>/user</code>路径的请求都会由user模块处理，那么<code>/user</code>的请求就是<code>user</code>模块的<code>/</code>对应的函数处理。<br>在routes&#x2F;user.js加一个路由：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;user2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>它本身在<code>app.js</code>就挂在到<code>/user</code>下了，内部再router.get(‘&#x2F;user’)，所以对应到路由就是访问<code>localhost:8080/user/user</code>才能看到user2的输出。另外可以看到后面的function有三个参数，req，res，next。分别对应请求体，相应体和下一个函数。这里先解释下next这个参数<br>修改routes&#x2F;user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    req.<span class="property">user</span> = <span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line">    res.<span class="property">user</span> = <span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;user name &#x27;</span> + req.<span class="property">user</span> + res.<span class="property">user</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>我们写了两个router.get(‘&#x2F;‘)的函数，路由会先找到第一个执行后再找到第二个继续执行，所以访问<code>localhost:8080/user</code>就会显示<code>user name aaabbb</code><br>这里第一个&#x2F;就可以理解为一种预处理。可以试试吧第一个&#x2F;的函数的next()删了看看会发生什么，或者吧next()改成<code>res.send(&#39;user&#39;)</code>看看页面显示啥。</p>
<h2 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离"></a>前后端分离</h2><p>前面写了那么多所谓的路由都是发送一串字符串，那我需要发送一个页面什么的怎么办呢？首先我们可以先尝试下<br>修改index.js代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;&lt;h1 style=&quot;color: red&quot;&gt;hello express&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>访问<code>http://localhost:8080</code>看看页面输出了什么？是不是h1标签的大小以及样式都应用上了？其实我们发送的不是一个严格的html文件，但是浏览器当做html解析了。那我们要发送好看的首页带css样式再加点js效果那不是字符串拼接要累死人了？别慌express帮我们搞定了，而且只需要一点点代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入path</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// 引入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 实例化express</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 引入别的路由模块</span></span><br><span class="line"><span class="keyword">const</span> index = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = <span class="built_in">require</span>(<span class="string">&#x27;./routes/user&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> timetable = <span class="built_in">require</span>(<span class="string">&#x27;./routes/timetable&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置静态资源路径，express自动处理get请求</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, index);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/user&#x27;</span>, user);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/timetable&#x27;</span>, timetable);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app;</span><br></pre></td></tr></table></figure>

<p>就加了两行<code>const path = require(&#39;path&#39;);</code>和<code>app.use(express.static(path.join(__dirname, &#39;public&#39;)));</code>。然后根目录下新建public文件夹，里面再新建一个index.html，写入点简单的代码<br>public&#x2F;index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>timetable<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Time Table<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> h1 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;h1&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(h1);</span></span><br><span class="line"><span class="language-javascript">    h1.<span class="property">innerHTML</span> += <span class="string">&#x27;123&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>打开浏览器<code>http://localhost:8080</code>就可以看到效果啦。好了，解释下上面加的那些代码的意义，html文件就不解释了。。。主要是<code>app.js</code>里面加的<code>const path = require(&#39;path&#39;);</code>和<code>app.use(express.static(path.join(__dirname, &#39;public&#39;)));</code>第一句就是引入path依赖，它是nodejs自带的一个模块，会自动处理文件路径拼接的符号问题。比如用字符串拼接’a&#x2F;‘+’&#x2F;b就是’a&#x2F;&#x2F;b’这个路径就会出错，但是path.join(‘a&#x2F;‘, ‘&#x2F;b’)结果就是’a\b’。（可以执行下routes&#x2F;test.js看看输出结果）。这里顺便解释了后面那一句<code>path.join(__dirname, &#39;public&#39;)</code>的意思，就是把<code>__dirname</code>和<code>public</code>两个路径拼起来，至于<code>__dirname</code>就是项目路径名，nodejs全局定义的一个变量。然后继续往外解释<code>express.static(path.join(__dirname, &#39;public&#39;))</code>。外面的express.static就是设置静态文件路径，最后用app.use引入到项目，这句话整个的意思就是把public目录下的文件都设置成静态文件，所有的请求都先去public下找一遍，并且吧对<code>/</code>目录的请求绑定为<code>public/index.html</code>。所以加了这一句，nodejs对于网页发出的所有请求都会先去public目录找一遍，找到就返回那个静态文件，没找到就进入下一步逻辑。</p>
<p>举个例子，在public目录下新建一个123.txt，里面随便打点东西比如我打了“123”。打开浏览器，输入<code>localhost:8080/123.txt</code>我们发出了一个对123.txt的请求，可以看到浏览器显示了这个文件的内容。所以，对于浏览器的请求，node就会在app文件里面绑定的路由（app.use或者app.get app.post）一个个找下来，找到了就执行相关逻辑（或者直接返回静态文件）没找到就出错啦。所以我们在<code>app.js</code>最后加上两个错误处理的函数（放在<code>app.js</code>的最后一行的上面，虽然放最后也无所谓，但是这样美观一点0v0）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;404 NOT FOUND！&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个就是处理所有的路由都没有找到的情况，这里使用了use没有第一个参数，直接就是一个function，表示所有的请求都会经过它。访问一个不存在的路由就可以看到效果，比如<code>localhost:8080/aaa</code>就可以看到页面显示“404 NOT FOUND！”，因为前面所有路由都没有匹配的话就会走到最后一个app.use（就是之前刚加的那个。）<br>这个和<code>app.use(express.static(path.join(__dirname, &#39;public&#39;)));</code>是一样的，所有的请求都会经过那个中间件，而<code>express.static()</code>最后返回的也是一个类似于<code>function (req, res, next)</code>这样的函数。所以我们可以了解到，express的前后端分离核心就是这一句，把public目录设置成静态文件目录导致浏览器所有请求会优先去public文件夹下寻找对应的文件，找到就返回。那么public目录就是前端的目录，前端使用html文件编写，可以直接返回并由浏览器渲染。</p>
<hr>
<h1 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h1><h2 id="前端基本结构"><a href="#前端基本结构" class="headerlink" title="前端基本结构"></a>前端基本结构</h2><p>前面已经讲了public目录就是静态文件目录也就可以理解为前端目录，并且已经新建了两个文件作为例子(<code>index.html</code>和<code>123.txt</code>)。现在我们把文件结构建完整。在public文件夹下面新建文件夹<code>css</code>,<code>js</code>,<code>img</code>,<code>lib</code>,<code>font</code>，（这里我为了让GitHub不忽略他所以某些文件夹加了个<code>.gitkeep</code>文件，因为GitHub会忽略空文件夹，虽然理论上里面放个什么文件都可以，但是大家还是约定成<code>.gitkeep</code>文件。）然后随便写点东西，先把一开始建立的index.html文件的css部分和js部分分离。在css文件夹下新建index.css，js文件夹下新建index.js。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* public/css/index.css */</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// public/js/index.js</span></span><br><span class="line"><span class="keyword">const</span> h1 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;h1&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(h1);</span><br><span class="line">h1.<span class="property">innerHTML</span> += <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>分离css和js后的html文件public&#x2F;index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>timetable<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Time Table<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里我们可以看到<code>&lt;link rel=&quot;stylesheet&quot; href=&quot;css/index.css&quot;&gt;</code>这个link标签的href直接引入了相对路径下的css。因为这个请求发送实质是一个对 <code>localhost:8080/css/index.css</code>的GET请求，所以服务端直接处理并返回了静态文件。由此也可以进一步确定public目录下的所有文件就是一个前端的工程项目。后端会自动发送相应请求文件。</p>
<h2 id="AngularJS：MVC"><a href="#AngularJS：MVC" class="headerlink" title="AngularJS：MVC"></a>AngularJS：MVC</h2><p>前端结构建好了就进入开发了，前端框架选择的是AngularJS，先引入文件（因为后续要使用webpack所以这里我们采用网络上的文件引入，所以确保自己联网。）<br>这里我们找了个AngularJS1.6.6版本的CDN引入。(CDN这里可以简单理解为别人存在网络上的文件我们可以直接用)。修改index.html文件（注：以下操作全部在public文件夹下，所以提到文件名都不说具体目录了，全部都在public或者它的子目录下的文件）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>timetable<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Time Table<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;双向绑定测试&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/angular.js/1.6.6/angular.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改index.js文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [])</span><br></pre></td></tr></table></figure>

<p>这里不会讲太多AngularJS的概念（可以参考官网或者哪天我有空了再写相关文章…）只会说一些我们实验室的开发流程。</p>
<p>首先AngularJS就是一个库，和JQuery一样的方式引入就好了，这里是<code>script</code>标签的<code>src</code>引入了一个网上的库。然后我们在body标签里面加了一个<code>ng-app=&quot;app&quot;</code>，然后js的代码<code>angular.module(&#39;app&#39;, [])</code>就申明了一个模块，<code>angular.module</code>这个函数接受两个参数，第一个是模块名，第二个是依赖名，第二个参数啥意思后面会介绍，现在因为我们没有别的依赖所以就让第二个参数为空数组。第一个参数的模块名就是对应页面上的<code>ng-app</code>的值，告诉AngularJS这个是一个模块名字叫做app(ng-app的等号后面的值)，所以页面上的ng-app后面的值要和js里面的angular.module的第一个参数一样，不然会出错。这里就叫app了。因为angular主要是单页应用的框架，所以只会有一个主html文件（就是包含head body等标签的html），别的代码都是以html片段的形式存在，在angular需要时会动态加载进来替换掉页面上的部分DOM结构。</p>
<p>解释完了我们写的代码，可以打开浏览器看看效果。我们发现在input框里输入的内容都会在后面出现。这里就是双向绑定的概念了，回到代码，发现我们在input框加入了<code>ng-model=&quot;name&quot;</code>，然后后面又加了<code>{{name}}</code>、<code>ng-model</code>的意思是把输入框的值和后面那个变量进行绑定<code>{{}}</code>的意思是把变量进行输出。这样input的内容有修改的话就可以实时在内存中变化了。同理要是内存中的变量变化了也会在input中显示（比如js代码修改了变量值）说说不解释概念还是废话了一堆..</p>
<p>刚刚提到内存中的变量，可能对这个概念有点懵逼，现在我们加上controller，就会对这个概念有点了解了。<br>修改index.html的一部分代码（就是div 标签上加了一个<code>ng-controller=&quot;appCtrl&quot;</code>）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;appCtrl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;双向绑定测试&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改index.js，定义一个controller（就是那个<code>.controller</code>），名字为appCtrl（第一个参数，是个字符串），第二个参数就是这个controller的内容（是个函数）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope</span>) &#123;</span><br><span class="line">        $scope.<span class="property">name</span> = <span class="number">123</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p><code>ng-controller</code>就是一个控制器，控制器是什么概念呢？简单理解下就是和页面绑定在一起的数据，比如页面里面的文字，输入框里面的内容，甚至是一个按钮的点击事件对应（绑定）的函数。为什么要叫控制器呢，因为这里的代码可以控制那些数据，并且可以和页面上的内容双向绑定。这样我们要得到页面上的数据就不用再通过获取结点，在获取内容的方式了，可以直接获取内存中的数据，也可以直接修改内存中的数据修改页面显示。比如上述代码就是通过修改内存中的name来修改页面中的name，所以打开<code>localhost:8080/</code>可以看到input输入框里面已经有一个123了。至于controller里面的$scope是啥？emmmmmm…继续简单理解下就是包含页面所有数据的一个对象，页面的所有变量的双向绑定的值都在这个$scope里面。</p>
<p>一句话总结controller：控制页面的数据。另外，页面的数据全部在$scope里面，$scope里面的东西在页面上也可以直接用。</p>
<p>为了加深理解，我们加个按钮显示数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;appCtrl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;双向绑定测试&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">&quot;show()&quot;</span>&gt;</span>show<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope</span>) &#123;</span><br><span class="line">        $scope.<span class="property">name</span> = <span class="number">123</span>;</span><br><span class="line">        $scope.<span class="property">show</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>($scope.<span class="property">name</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>可以看到，在html里面我们在input下面加了一个button，并在标签里面加上了<code>ng-click=&quot;show()&quot;</code>这个ng-click就是angular的事件绑定的写法，至于这个show()自然就是绑定在click时间的函数啦，show这个函数在controller里面就是$scope.show，之前说了，页面的所有内容都是在$scope下的。然后我们在controller里面给它赋值了一个函数，函数log出<code>$scope.name</code>，现在打开控制台，点击按钮，就能看到控制台输出了123，我们修改input的内容，再按一下按钮，会发现控制台输出了我们填写的内容，这就是双向绑定的直观概念，它的好处也就显而易见了，对于表单啊什么的直接绑定到$scope里面了，点击按钮就可以发送请求给后端了，不用麻烦的一个个获取。</p>
<p>我们试试看吧</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;appCtrl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;user.name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;user.pwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">&quot;submit()&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope</span>) &#123;</span><br><span class="line">        $scope.<span class="property">submit</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>($scope.<span class="property">user</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>我们修改了设置了controller的那个div里面的内容，加了两个input用于输入用户名和密码，ng-mode我们绑定到了user的两个属性，button的click绑到了submit函数。注意，我们ng-model不是name和pwd，而是user.name和user.pwd，这样controller里面直接<code>$scope.user</code>就是包含了两个属性的对象，非常方便。在另外，页面的数据会自动存放在controller里面，我们不用在controller里面重新定义一遍就可以直接用（比如这里就是<code>console.log($scope.user);</code>我们在外面并没有也不需要定义$scope.user）现在看看效果。打开<code>http://localhost:8080</code>随便输入什么，点击提交，就可以看到控制台输出了user对象。当然我们也可以初始化一下，设置默认值，这个在调试阶段特别好用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope</span>) &#123;</span><br><span class="line">        $scope.<span class="property">user</span> = &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="number">123</span>,</span><br><span class="line">            <span class="attr">pwd</span>: <span class="number">123</span></span><br><span class="line">        &#125;;</span><br><span class="line">        $scope.<span class="property">submit</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>($scope.<span class="property">user</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>刷新一下浏览器，可以看到两个输入框已经有内容了，在调试时就不用反复输入了。</p>
<p>好了，我们已经可以在控制台看到数据打印出来了，那么怎么发送到后端呢？这里就要用ajax了，ajax就是一个发送异步请求的东西而已，具体不详细讲，只说怎么用（具体内容可看我写的有关angular的内容，有空写的话。。。）在angular里面，提供了一个$http的服务用语发送请求。$http和$scope一样，都是一个angular提供的服务，需要作为controller的参数才能使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope, $http</span>) &#123;</span><br><span class="line">        $scope.<span class="property">user</span> = &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="number">123</span>,</span><br><span class="line">            <span class="attr">pwd</span>: <span class="number">123</span></span><br><span class="line">        &#125;;</span><br><span class="line">        $scope.<span class="property">submit</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>($scope.<span class="property">user</span>);</span><br><span class="line">            $http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/login&#x27;</span>,$scope.<span class="property">user</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>首先可以看到我们在controller的参数里面加入了$http,然后可以看到在submit函数里面加了一行<code>$http.post(&#39;http://localhost:8080/user/login&#39;,$scope.user);</code>。这一行表示向localhost:8080&#x2F;user&#x2F;login这个路径发送了一个post请求，请求的参数是$scope.user。好了，我们要在这里插入一点后端的内容。前端已经吧输入发过去了，后端怎么获取呢？还记得之前后端的router.get么，它接受get请求，事实上我们在浏览器上输入一个url就是一个get请求。现在要一个post，那么我们就加上对post的处理。<br>修改根目录的routes文件夹下的user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>,<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;login&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>这里我们先输出一个login字符串来看看是不是请求到了这个接口（所谓的接口就是一个uri，比如这里就是<code>http://localhost:8080/user/login</code>）。点击submit，然后打开运行着npm start的那个命令行，可以看到在黑框框下输出了一个字符串“login”，说明我们成功请求到这个接口了，那么问题就来了，我们怎么获取到传过来的参数呢？express有很好的中间件机制，当然是使用别人提供的中间件啦！这里我们用body-parser这个中间件，它可以预先帮我解析请求中的请求体，并把post请求的参数设置到req.body里面。首先要安装，在命令行多按几次ctrl+c终止那个那个npm start的命令，然后执行<code>npm i --save body-parser</code>，安装完后去修改根目录下的app.js，吧依赖引入进来，并用app.use把body-parser配置好</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入path</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// 引入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 实例化express</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 引入body-parser</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="comment">// 引入别的路由模块</span></span><br><span class="line"><span class="keyword">const</span> index = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = <span class="built_in">require</span>(<span class="string">&#x27;./routes/user&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> timetable = <span class="built_in">require</span>(<span class="string">&#x27;./routes/timetable&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析json格式的post请求体，给req添加body属性</span></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line"><span class="comment">// 中间件只解析urlencoded 请求体，并返回，只支持UTF-8编号文本</span></span><br><span class="line"><span class="comment">// extend</span></span><br><span class="line"><span class="comment">// ture-&gt;使用queryString库（默认） false-&gt;使用qs库。</span></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置静态资源路径，express自动处理get请求</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, index);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/user&#x27;</span>, user);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/timetable&#x27;</span>, timetable);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;404 NOT FOUND！&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app;</span><br></pre></td></tr></table></figure>

<p>其实我们就加了这3行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br></pre></td></tr></table></figure>

<p>第一行引入依赖没啥问题，后两行用app.use说明所有的请求都会经过他们，和设置静态页面一样的用法。至于后两行use里面啥意思，上面的文件也做了详细说明，这里，具体可以自行搜索相关资料进一步学习，这里我们暂时就知道怎么用就好了。<br>然后我们的req.body里面应该已经有内容了。修改routes&#x2F;user.js，把之前的login字符串改为req.body</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>,<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>好，继续运行npm start，打开浏览器按submit。在打开命令行的时候我们可以看到输出的不是login了，而是<code>&#123; name: 123, pwd: 123 &#125;</code>这个对象，前端已经成功到后端了，那么后端怎么发送信息给前端呢？超简单res.send啊！不不不，我们的意思是，前端怎么收到呢？angular的$http早就帮我们搞定了这些。<br>routes&#x2F;user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>,<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;登陆成功!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>public&#x2F;js&#x2F;index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope, $http</span>) &#123;</span><br><span class="line">        $scope.<span class="property">user</span> = &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="number">123</span>,</span><br><span class="line">            <span class="attr">pwd</span>: <span class="number">123</span></span><br><span class="line">        &#125;;</span><br><span class="line">        $scope.<span class="property">submit</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>($scope.<span class="property">user</span>);</span><br><span class="line">            $http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/login&#x27;</span>,$scope.<span class="property">user</span>)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>后端部分就是加了一个res.send发送了一个字符串，前端部分可以看到我们在刚刚那个post下加了一个then，这里$http.post返回了一个promise，具体promise是啥可以百度也可以看我别的文章（哇，我都挖了几个坑了。。。慢慢填。。。）then接受两个参数，都是函数，第一个函数是返回成功时的情况，第二个函数就是返回错误是的情况。我们暂时先不考虑错误情况，直接then接受一个函数，然后把res作为参数并打印出来，可以看到控制台输出了好多东西。嘛。。。其实也就是一个对象啦，我们关注data这个字段就好了，可以看到data这个字段里面的东西就是后端返回的值。<br>装个逼用一下es6的解构赋值（也不算啥新东西啦，es8都要出来了。。。）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/login&#x27;</span>,$scope.<span class="property">user</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/login&#x27;</span>, $scope.<span class="property">user</span>)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">&#123;data&#125;</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure>

<p>再刷新浏览器点击提交，就可以看到控制台输出后端返回的字符串啦，是不是很简单~</p>
<p>随着逻辑越来越复杂，在controller里面既要控制页面的数据，又要和后端交互处理请求相应，那代码就会越来越庞大，是事实再分离一波了！这时候就可以手写service了。service字面意思就是服务，就是提供一些通用的服务供controller调用，其实之前用到的$scope,$http都是服务，只不过它们是angular提供的服务，我们也可以自己定义服务。比如定义一个UserService服务，把和用户相关的比如登录注册重置密码的逻辑都放在这里供controller调用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// public/js/index.js</span></span><br><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope, UserService</span>) &#123;</span><br><span class="line">        $scope.<span class="property">user</span> = &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="number">123</span>,</span><br><span class="line">            <span class="attr">pwd</span>: <span class="number">123</span></span><br><span class="line">        &#125;;</span><br><span class="line">        $scope.<span class="property">submit</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>($scope.<span class="property">user</span>);</span><br><span class="line">            <span class="title class_">UserService</span>.<span class="title function_">login</span>($scope.<span class="property">user</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">service</span>(<span class="string">&#x27;UserService&#x27;</span>, <span class="keyword">function</span> (<span class="params">$http</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">login</span> = <span class="keyword">function</span> (<span class="params">user</span>) &#123;</span><br><span class="line">            $http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/login&#x27;</span>, user)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">&#123;data&#125;</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>这样虽然controller和service分开了，但是都放在一个文件还是觉得很乱，那我们进一步分离，首先删了public&#x2F;js&#x2F;index.js。因为我们要把它拆开。<br>在public文件夹下新建app.js作为主要入口，然后在public&#x2F;js下新建controller.js和service.js<br>public&#x2F;app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;app.controller&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app.service&#x27;</span></span><br><span class="line">])</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>public&#x2F;js&#x2F;controller.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app.controller&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope, UserService</span>) &#123;</span><br><span class="line">        $scope.<span class="property">user</span> = &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="number">123</span>,</span><br><span class="line">            <span class="attr">pwd</span>: <span class="number">123</span></span><br><span class="line">        &#125;;</span><br><span class="line">        $scope.<span class="property">submit</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>($scope.<span class="property">user</span>);</span><br><span class="line">            <span class="title class_">UserService</span>.<span class="title function_">login</span>($scope.<span class="property">user</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>public&#x2F;js&#x2F;service.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app.service&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">service</span>(<span class="string">&#x27;UserService&#x27;</span>, <span class="keyword">function</span> (<span class="params">$http</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">login</span> = <span class="keyword">function</span> (<span class="params">user</span>) &#123;</span><br><span class="line">            $http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/login&#x27;</span>, user)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">&#123;data&#125;</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>好了，分完了，就是把controller，service简单拆了一下，另外controller.js第一行的module名字取为“app.controller”，service的module名字取为“app.service”。然后在app.js里面的module的第二个参数去进行“依赖注入”，就是把module名字放进数组里就好啦。<br>最后还有一步！把这些js引入到html里面（把index的引入删除在加上新加的三个文件的引入）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/angular.js/1.6.6/angular.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/controller.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/service.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>好了运行<code>http://localhost:8080</code>看看效果吧（应该没什么效果，和原来一样的界面）</p>
<h2 id="webpack的加入"><a href="#webpack的加入" class="headerlink" title="webpack的加入"></a>webpack的加入</h2><p>可以看到，之前我们只是简单做了个代码分离，就要在index.html多加入三个script标签，以后万一要加上别的库文件又是一大堆script标签，然后要加上css的话继续一堆link。。。另外，每次写完代码都要刷新一遍网页也很烦，后端部分我们已经用supervisor自动重启服务器来减轻负担了，前端有没有自动刷新浏览器什么的工具啊？必须是有的，而且可以一起吧上面两个问题全部解决！</p>
<p>webpack就是这么一个工具，它会从一个（或多个）js文件开始，一次查找所有的依赖，并引入进来打包成一个js文件。它强大的加载器以及插件可以做到找到css依赖甚至编译less，scss，ts等语言并引入。还有一个叫做webpack-dev-server的东西可以实现热加载（就是自动刷新浏览器，甚至不刷新浏览器就可以修改页面）。它的工作全部都写入一个配置文件，并根据配置文件的内容，实现一定功能，比如最基础的查找js依赖，配置完加载器后可以加载css文件，编译less，scss，配置devServer后可以热更新，配置html插件后可以吧标签自动插入到html文件里面。</p>
<p>听得那么多都心动了吧？那我们开始吧！</p>
<p>既然要用webpack，当然得先安装（下载）喽，就是一句npm i的事，但是我们要装的不只是webpack，还有一些别的东西（因为webpack要加载html等需要别的配置，所以需要相关加载器或者插件等）这里我们就一次性下完啦。。。<br><code>npm i --save-dev webpack webpack-dev-server html-webpack-plugin open-browser-webpack-plugin</code><br><code>npm i --save-dev babel babel-core babel-loader babel-plugin-istanbul babel-preset-es2015</code><br><code>npm i --save-dev css-loader less-loader postcss-loader sass-loader style-loader</code><br><code>npm i --save-dev file-loader html-loader istanbul-instrumenter-loader url-loader</code><br>为了美观点我这里分成了4条，当然也可以写到一句里面。。第一条是webpack和热加载的服务器webpack-dev-server，后面两个是webpack的两个插件，第一个用于自动在html里面插入标签（当然它有更牛逼的功能，这里我们就用来插入标签了，就是打包后的script标签就是靠它加入到html文件的）第二个是自动打开浏览器的插件。第二条是js相关的编译加载器，第三条是css相关，最后一条是别的杂七杂八的加载器。。。因为webpack本身只是处理js中的模块依赖问题的，有了这些加载器后可以加载别的css等文件（还可以编译es6，编译less等）</p>
<p>好了装完后怎么让它们合作起来呢？根目录下新建一个webpack.config.js的文件（这是webpack的默认配置文件名，要是换别的名字需要在启动webpack时指定。用这个名就不用另外指定了）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OpenBrowserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;open-browser-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义了一些路径</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">APP_PATH</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;public/app.js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">BUILD_PATH</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;build&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">// 入口，分为app 入口和提取插件库的入口</span></span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">app</span>: <span class="variable constant_">APP_PATH</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出文件路径和名字</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="variable constant_">BUILD_PATH</span>,</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./public/index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">inject</span>: <span class="string">&#x27;body&#x27;</span>,</span><br><span class="line">            <span class="attr">minify</span>: <span class="literal">false</span></span><br><span class="line">        &#125;),</span><br><span class="line"></span><br><span class="line">        <span class="comment">//自动启动浏览器</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">OpenBrowserPlugin</span>(&#123;<span class="attr">url</span>: <span class="string">&#x27;http://localhost:8081&#x27;</span>&#125;)</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">//dev 服务器</span></span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">historyApiFallback</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">inline</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">progress</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">contentBase</span>: <span class="string">&quot;./build&quot;</span>, <span class="comment">// dev server的根路径</span></span><br><span class="line">        <span class="attr">port</span>: <span class="number">8081</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="string">&quot;loaders&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;html-loader&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;style-loader!css-loader&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.less/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;style-loader!css-loader!less-loader&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(png)|(jpg)|(gif)|(woff)|(svg)|(eot)|(ttf)$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">limit</span>: <span class="number">50000</span>,   <span class="comment">//小于50K的 都打包</span></span><br><span class="line">                            <span class="attr">name</span>: <span class="string">&quot;[hash:8].[name].[ext]&quot;</span>,</span><br><span class="line">                            <span class="attr">publicPath</span>: <span class="string">&quot;img/&quot;</span>,  <span class="comment">//替换CSS引用的图片路径 可以替换成爱拍云上的路径</span></span><br><span class="line">                            <span class="attr">outputPath</span>: <span class="string">&quot;../img/&quot;</span>        <span class="comment">//生成之后存放的路径</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.js?$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                <span class="attr">include</span>: <span class="variable constant_">APP_PATH</span>,</span><br><span class="line">                <span class="attr">query</span>: &#123;</span><br><span class="line">                    <span class="attr">presets</span>: [<span class="string">&#x27;es2015&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我知道被甩一脸代码你的内心是拒绝的，emmm…毕竟webpack有很多东西，详细信息需要参考官网文档，这里只给出了一些简单的配置例子而已（我也掌握的不多，仅仅是能用的程度ORZ…）之前已经提到了webpack是依赖处理工具，所以开头配置就是entry字段，entry表示依赖的起点，表示js的根文件，也是它查找依赖的起点。然后有entry就有output，这就是编译完后的代码存放的位置，另外webpack通过插件和模块加载器来扩展功能，比如我们加了HtmlWebpackPlugin插件配置，就表示吧生成的代码作为资源引用插入到对应html的body标签，OpenBrowserPlugin插件就表示以默认浏览器自动打开对应url。关于这些插件的用法每个都有相关的官方文档可供参考，这些不是webpack自带的，需要开发者自行查找相关插件（一般你遇到的诡异的需求都有别人给你做好的插件可以用）。devServer字段就是配置webpack-dev-server的地方，后面的module就是模块的加载器了，比如webpack不认识html文件就需要用HTML加载器引入。这里就是简单提一下webpack算是抛砖引玉，要深入学习还是要去啃webpack官方文档啊~另外这里就是单纯的够用，比如现在babel有些更新也没怎么关注…一切使用以官方文档为准。</p>
<p>好了，配置文件都写完了是不是迫不及待要试一下？别急，有些地方也得改一改。首先当然是html文件删除所有的script，link标签。<br>public&#x2F;index.html就只剩下下面这坨光秃秃的代码了，看上去清爽了一点</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>timetable<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Time Table<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;appCtrl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;user.name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;user.pwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">&quot;submit()&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>至于我们删除部分的代码之前webpack配置的插件会吧打包后的代码自动引入的~<br>下一步改造js，既然app.js定义了app模块和界面绑定，它显然就是起点啦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// public/app.js</span></span><br><span class="line"><span class="keyword">import</span> angular <span class="keyword">from</span> <span class="string">&#x27;angular&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> controller <span class="keyword">from</span> <span class="string">&#x27;./js/controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> service <span class="keyword">from</span> <span class="string">&#x27;./js/service&#x27;</span>;</span><br><span class="line"></span><br><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [</span><br><span class="line">    controller,</span><br><span class="line">    service</span><br><span class="line">])</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./css/index.css&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>emmmmm….似乎我们把angular的scrip也删了，然后还忘记装了？那装一下吧。。。<code>npm i --save angular</code>。然后可以看到我们原来直接写在数组里的是字符串，现在是引入的内容。至于这个import只是一个es6的模块语法，表示从对应的文件引入某个变量或者函数。既然引入了，那对应的文件是不是要导出？没错，继续改造controller和service文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public/js/controller.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> angular.<span class="title function_">module</span>(<span class="string">&#x27;app.controller&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope, UserService</span>) &#123;</span><br><span class="line">        $scope.<span class="property">user</span> = &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="number">123</span>,</span><br><span class="line">            <span class="attr">pwd</span>: <span class="number">123</span></span><br><span class="line">        &#125;;</span><br><span class="line">        $scope.<span class="property">submit</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>($scope.<span class="property">user</span>);</span><br><span class="line">            <span class="title class_">UserService</span>.<span class="title function_">login</span>($scope.<span class="property">user</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="property">name</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public/js/service.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> angular.<span class="title function_">module</span>(<span class="string">&#x27;app.service&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">service</span>(<span class="string">&#x27;UserService&#x27;</span>, <span class="keyword">function</span> (<span class="params">$http</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">login</span> = <span class="keyword">function</span> (<span class="params">user</span>) &#123;</span><br><span class="line">            $http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/login&#x27;</span>, user)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">&#123;data&#125;</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="property">name</span>;</span><br></pre></td></tr></table></figure>

<p>controller和service的修改完全一样就是加个导出而已，至于controller和service用到的angular，已经在app导入过了，你想再导入一遍也没啥问题，因为webpack会判断发现已经有了就不会重复导入。导出的语法就是一个export，至于default，就是默认导出，这个每个文件只能有一个，别人导入的时候就可以不用管有什么无脑导入就行了。至于更多的es6模块部分的内容建议阅读相关博客深入了解。<strong>（敲黑板！！es6是必修课！！）</strong><br>最后一步，启动命令行！当然先加个别名，可以少打点东西也好记，怎么加之前已经提过了，就是在package.json的scripts字段加一条<br><code>&quot;dev&quot;: &quot;webpack-dev-server --history-api-fallback --hot --inline --progress --content-base ./build/ --port 8081&quot;</code><br>因为之前装了好多依赖，所以现在package.json文件是这样的</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timetable&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;supervisor bin/www&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack-dev-server --history-api-fallback --hot --inline --progress --content-base ./build/&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;angular&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.6.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;body-parser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.18.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;express&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.16.2&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;babel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.23.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;babel-core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.26.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;babel-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.1.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;babel-plugin-istanbul&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.1.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;babel-preset-es2015&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.24.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;css-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.28.7&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.1.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;html-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.5.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;html-webpack-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.30.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;istanbul-instrumenter-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;less-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;open-browser-webpack-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;postcss-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.8&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sass-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.0.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;style-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.19.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;supervisor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.12.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;url-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.6.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webpack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.8.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webpack-dev-server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.9.4&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>恩，终于结束了。。。转换的过程是痛苦的，结果是美好的，现在打开命令行进入项目根目录输入<code>npm run dev</code>，可以看到浏览器自动打开了，界面什么的和之前一样，我们可以随便修改点css代码看看效果，比如把颜色改为蓝色，然后回到浏览器就可以看到自动更新了。然而当我们点击提交却出错了，他说我们跨域了。跨域是因为webpack-dev-server自己开了一个服务器在8081端口，我们额后端是8080端口，所以就被拒绝了，我们只要在后端加几行就好了。<br>打开根目录下的app.js文件，在这几行的<strong>上面</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, index);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/user&#x27;</span>, user);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/timetable&#x27;</span>, timetable);</span><br></pre></td></tr></table></figure>

<p>加上这几行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app访问预处理中间件</span></span><br><span class="line"><span class="comment">// 设置跨域请求许可以及返回内容的数据格式</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>); <span class="comment">//允许哪些url可以跨域请求到本域</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;GET,POST&quot;</span>); <span class="comment">//允许的请求方法，一般是GET,POST,PUT,DELETE,OPTIONS</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;x-requested-with,content-type,Token&quot;</span>); <span class="comment">//允许哪些请求头可以跨域</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后在点击提交试试，应该就好了，这是nodejs常用的解决跨域的方式。</p>
<hr>
<h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><h2 id="MongoDB简介"><a href="#MongoDB简介" class="headerlink" title="MongoDB简介"></a>MongoDB简介</h2><p>前后端都连上了，该到数据库了。前端发过来的用户名和密码，我们需要存到数据库，一个注册的功能通常都是这样，前端发送用户输入的数据到后端，后端存入数据库中，这样下次这个用户只需要登录就好，并且与他相关的数据也会保存在一块。</p>
<p>常用的数据库是关系数据库，常见的Oracle，SQL Server还有MySQL等都是关系数据库。但是面对互联网日益爆增的数据量，关系数据库逐渐显得力不从心，于是出现了一类新型的数据库。我们称为NoSQL，Not Only SQL。非关系型数据库。非关系数据库又有好多种，MongoDB属于其中的文档型数据库。它的优点是数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构（这句来自百度百科）。而且存储结构就是json的结构，非常适合与js协作。</p>
<p>MongoDB的安装不多说了就是一个数据库引擎而已。主要是启动会有点东西需要配置。而每次手动启动也很烦一般就把它设置为一个服务了然后开机自启就行。这里引用菜鸟教程的<a href="http://www.runoob.com/mongodb/mongodb-window-install.html">配置方式</a></p>
<blockquote>
<p>管理员模式打开命令行窗口<br>创建目录，执行下面的语句来创建数据库和日志文件的目录<br>mkdir c:\data\db<br>mkdir c:\data\log<br>创建配置文件<br>创建一个配置文件。该文件必须设置 systemLog.path 参数，包括一些附加的配置选项更好。<br>例如，创建一个配置文件位于 C:\mongodb\mongod.cfg，其中指定 systemLog.path 和 storage.dbPath。具体配置内容如下：</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">    destination: file</span><br><span class="line">    path: c:\data\log\mongod.log</span><br><span class="line">storage:</span><br><span class="line">    dbPath: c:\data\db</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过执行mongod.exe，使用–install选项来安装服务，使用–config选项来指定之前创建的配置文件。<br>“C:\mongodb\bin\mongod.exe” –config “C:\mongodb\mongod.cfg” –install<br>启动MongoDB服务<br>net start MongoDB<br>关闭MongoDB服务<br>net stop MongoDB<br>移除MongoDB服务<br>“C:\mongodb\bin\mongod.exe” –remove</p>
</blockquote>
<p>闲每次开启服务麻烦可以去windows的“服务”里设置开机自启动</p>
<h2 id="MongoDB可视化工具"><a href="#MongoDB可视化工具" class="headerlink" title="MongoDB可视化工具"></a>MongoDB可视化工具</h2><p>所谓可视化工具也可以称为数据库管理工具，就是可以直接在界面上以用户友好的方式查看数据库的内容。MongoDB的话我常用的是mongobooster和Robomongo，mongobooster支持数据库的json文件导入导出，但是界面上个人认为Robomongo更友好一点，所以我一般做简单的查询修改都是用Robomongo。至于这两个软件就自行寻找安装包安装啦，就是两个普通软件而已…mongobooster是收费的，不过免费部分的功能也够用了（反正我只是用来导入导出数据。。。）</p>
<p>Robmongo打开后要创建连接，链接本地的数据库服务后才可以操作里面的内容，点击create，保持默认点击save就好了，你愿意的话save之前改一下name啥的也行，（我改成了localhost。。）另外MongoDB默认是没有密码的，所以安全方面要另外设置，这里只是入门就保持默认了，做项目要用MongoDB一定要设置密码哦。然后连上后里面只有system和test，这是默认的数据库别理它。。</p>
<h2 id="mongoose库介绍"><a href="#mongoose库介绍" class="headerlink" title="mongoose库介绍"></a>mongoose库介绍</h2><p>前面配置了数据库和可视化软件，现在就要正式码代码啦。道理我都懂，所以我要怎么用js来操作数据库呢？emmmmm，在后端程序和数据库引擎之前我们需要一个桥梁，这就是数据库驱动，所以我们需要安装一个库来帮我们，这里我选的是mongoose这个库。执行<code>npm i --save mongoose</code>安装mongoose库。装完后我们需要创建一个链接，连上后就可以用js代码操作数据库了。链接很简单，无非就是端口号啊数据库名啊账号密码啊之类的对上就好了，因为默认没有账号密码所以就需要端口号和数据库名，这里我们选择time_table作为名字。然后我们总不能操作一次重新写一段连接数据库的代码吧？所以根目录下新建一个config文件夹里面新建config.js，写上以下内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//config/config.js</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost:27017/time_table&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mongoose.<span class="property">connection</span>;</span><br><span class="line">db.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="variable language_">console</span>.<span class="property">error</span>.<span class="title function_">bind</span>(<span class="variable language_">console</span>, <span class="string">&#x27;connection error:&#x27;</span>));</span><br><span class="line">db.<span class="title function_">once</span>(<span class="string">&#x27;open&#x27;</span>, <span class="variable language_">console</span>.<span class="property">log</span>.<span class="title function_">bind</span>(<span class="variable language_">console</span>, <span class="string">&#x27;connection success:&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">mongoose</span> = mongoose;</span><br></pre></td></tr></table></figure>

<p>这些代码均可以从mongoose的<a href="http://mongoosejs.com/docs/index.html">文档</a>里找到，代码很简单，导入mongoose库后创建一个链接然后导出mongoose。我们之前不是说后端已经拿到数据了么，在routes&#x2F;user.js里。我们只是简单的输出了一下前端的数据，现在我们要真正把它保存到数据库里面。以下的代码也从文档中可以找到。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//导入已经配置好数据库连接的mongoose库</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;../config/config&#x27;</span>).<span class="property">mongoose</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义User这个&quot;表&quot;，noSQL术语叫做集合(collection)，调用mongoose.model并传入第一个参数是表名，第二个是表的结构</span></span><br><span class="line"><span class="comment">//其中第二个参数作为表的结构使用mongoose.Schema定义，具体内容官网都有详细的文档。</span></span><br><span class="line"><span class="keyword">const</span> userSchema = mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">pwd</span>: <span class="title class_">String</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, userSchema);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>,<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">    <span class="comment">//根据定义的model新建一个对象并保存，第二个参数是保存成功后的回调函数</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(req.<span class="property">body</span>);</span><br><span class="line">    user.<span class="title function_">save</span>(<span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;登陆成功!&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>可以看到我们对routes&#x2F;user.js做了点手脚，首先导入配置好的mongoose库，然后新建了一个User的结构，另外提一句，mongoose.model第一个参数的复数形式才是真正的表名。前端数据发过来后我们用发过来的数据new了一个user并保存了。现在去页面上点击提交可以看到命令行里面输出了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">name</span>: <span class="number">123</span>, <span class="attr">pwd</span>: <span class="number">123</span> &#125;</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">&#x27;123&#x27;</span>, <span class="attr">pwd</span>: <span class="string">&#x27;123&#x27;</span>, <span class="attr">_id</span>: 5a8d7d85148af21d2ca5baa7, <span class="attr">__v</span>: <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure>

<p>第一个自然就是前端传过来的数据，第二个就是保存的数据，MongoDB自动生成了<code>_id</code>和<code>_v</code>两个字段<code>_id</code>自然是唯一的值用于区分每个对象，这个值大家应该都不一样，至于这个值怎么产生的可以参考<a href="http://blog.csdn.net/after_you/article/details/66971680">这个</a>，总之你知道<code>_id</code>可以用于唯一区分数据库里一条数据就好了。<code>_v</code>是版本号，具体用法可以看<a href="http://mongoosejs.com/docs/guide.html#versionKey">官方文档</a>。然后我们打开Robmongo可以看到里面多了”time_table”这个，如果没有的话右键连接名（就是侧栏最上面那个，名字取决于你创建时的名字，我的是localhost，默认是New Connection）找到第二个Refresh，刷新完就有了。然后可以看到下面有Collections，Functions，Users。展开Collections，可以看到users，双击就能看到里面的数据了，可以看到这样的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;5a8d7a29f54eab2accaca062&quot;</span>),</span><br><span class="line">    <span class="string">&quot;name&quot;</span> : <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pwd&quot;</span> : <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span> : <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>去网页上多点几下提交再打开Robmongo就变成这样了（没变化的话按f5刷新）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;5a8d7a29f54eab2accaca062&quot;</span>),</span><br><span class="line">    <span class="string">&quot;name&quot;</span> : <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pwd&quot;</span> : <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span> : <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2 */</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;5a8d7d85148af21d2ca5baa7&quot;</span>),</span><br><span class="line">    <span class="string">&quot;name&quot;</span> : <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pwd&quot;</span> : <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span> : <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3 */</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;5a8d840e148af21d2ca5baa8&quot;</span>),</span><br><span class="line">    <span class="string">&quot;name&quot;</span> : <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pwd&quot;</span> : <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span> : <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到我们每次点一下提交就执行了一次保存，又因为主键id是自动生成的所以name和pwd重复它也会保存，如果我们要让name不能重复，那这些逻辑都需要自己代码实现，比如先查询一下数据库看看name有没有被占用，没有的话就保存，有的话就返回一个错误信息。我们可以对login接口做如下修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">    <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;<span class="string">&#x27;name&#x27;</span>: req.<span class="property">body</span>.<span class="property">name</span>&#125;, <span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;数据库错误&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;用户已存在&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//根据定义的model新建一个对象并保存，第二个参数是保存成功后的回调函数</span></span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(req.<span class="property">body</span>);</span><br><span class="line">            user.<span class="title function_">save</span>(<span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span><br><span class="line">                res.<span class="title function_">send</span>(<span class="string">&#x27;登陆成功!&#x27;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>User.findOne就是去users这个collection里面查找一个，找到或者没找到都会返回，找到了后回调函数的第二个参数就是user。没找到第二个参数就是null。所以如果user不是null就返回用户已存在，否者就保存。可以去网页上试验一下，点击提交可以看到控制台输出了用户已存在，把name改成1234再点提交就输出登录成功了。emmm…仔细想想这怎么会是登录呢，这明明应该是注册的逻辑嘛<del>那我们就做简单的修改，把它变成register就好了</del>上面的<code>/login</code>改成<code>/register</code>，在新建一个login的逻辑。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="title class_">User</span>.<span class="title function_">findOne</span>(req.<span class="property">body</span>, <span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;数据库错误&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;登陆成功!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;账号或密码错误!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">    <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;<span class="string">&#x27;name&#x27;</span>: req.<span class="property">body</span>.<span class="property">name</span>&#125;, <span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;数据库错误&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;用户已存在&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//根据定义的model新建一个对象并保存，第二个参数是保存成功后的回调函数</span></span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(req.<span class="property">body</span>);</span><br><span class="line">            user.<span class="title function_">save</span>(<span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span><br><span class="line">                res.<span class="title function_">send</span>(<span class="string">&#x27;登陆成功!&#x27;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样才像样嘛，注册才需要写入数据库，登录只要判断有没有这儿数据就行了，有就说登陆成功没有就说账号或者密码错误。关注login接口的这一行<code>User.findOne(req.body, function (err, user) &#123;...&#125;)</code>第一个参数直接就是req.body。因为我们定义的数据结构和前端传过来的一样所以就这么写，完整的写法是这样的：<code>User.findOne(&#123;name:req.body.name, pwd:req.body.pwd&#125;, function (err, user) &#123;...&#125;)</code>（在这里也是多此一举的写法。。。）。findOne的第一个参数就是查找条件，只有完全满足才行。api文档看<a href="http://mongoosejs.com/docs/api.html#findone_findOne">这里</a></p>
<p>改完后端那顺便前端也改了呗~<br>public&#x2F;index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;appCtrl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;user.name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;user.pwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">&quot;login()&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">&quot;register()&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public/js/controller.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> angular.<span class="title function_">module</span>(<span class="string">&#x27;app.controller&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">controller</span>(<span class="string">&#x27;appCtrl&#x27;</span>, <span class="keyword">function</span> (<span class="params">$scope, UserService</span>) &#123;</span><br><span class="line">        $scope.<span class="property">user</span> = &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="number">123</span>,</span><br><span class="line">            <span class="attr">pwd</span>: <span class="number">123</span></span><br><span class="line">        &#125;;</span><br><span class="line">        $scope.<span class="property">login</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title class_">UserService</span>.<span class="title function_">login</span>($scope.<span class="property">user</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        $scope.<span class="property">register</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title class_">UserService</span>.<span class="title function_">register</span>($scope.<span class="property">user</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="property">name</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public/js/service.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> angular.<span class="title function_">module</span>(<span class="string">&#x27;app.service&#x27;</span>, [])</span><br><span class="line">    .<span class="title function_">service</span>(<span class="string">&#x27;UserService&#x27;</span>, <span class="keyword">function</span> (<span class="params">$http</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">login</span> = <span class="keyword">function</span> (<span class="params">user</span>) &#123;</span><br><span class="line">            $http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/login&#x27;</span>, user)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">&#123;data&#125;</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">register</span> = <span class="keyword">function</span> (<span class="params">user</span>) &#123;</span><br><span class="line">            $http.<span class="title function_">post</span>(<span class="string">&#x27;http://localhost:8080/user/register&#x27;</span>, user)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">&#123;data&#125;</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="property">name</span>;</span><br></pre></td></tr></table></figure>

<p>改动很简单，就是原来提交的按钮改成了两个按钮，一个登陆一个注册。对应的controller，service也改成了登录，注册的逻辑。当然，真实应用的注册应该不止这两个字段，登录和注册的内容应该也是不一样的。这里就一切从简了。</p>
<p>细心的童鞋应该发现了，routes&#x2F;user.js里面除了一个登陆一个注册还有一些诡异的代码，就是定义数据结构啊之类的。如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入已经连接好数据库的mongoose库</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;../config/config&#x27;</span>).<span class="property">mongoose</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义User这个&quot;表&quot;，noSQL术语叫做集合(collection)，调用mongoose.model并传入第一个参数是表名，第二个是表的结构</span></span><br><span class="line"><span class="comment">//其中第二个参数作为表的结构使用mongoose.Schema定义，具体内容官网都有详细的文档。</span></span><br><span class="line"><span class="keyword">const</span> userSchema = mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">pwd</span>: <span class="title class_">String</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>

<p>这些代码定义了users集合的数据结构，并且User这个模型(model)也是和数据库直接绑定的，就是说我们要通过这个User来操纵users这个集合。所以别的地方要用users里面的数据就要获取到User的实例，那么我们就要吧User导出，但是这样是不合理的，因为这个文件只是一个路由，User相关的定义应该放到别的地方统一定义。所以在根目录下新建model文件夹，并新建User.js吧模型定义的相关代码移出去。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//model/User.js</span></span><br><span class="line"><span class="comment">//导入已经连接好数据库的mongoose库</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;../config/config&#x27;</span>).<span class="property">mongoose</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义User这个&quot;表&quot;，noSQL术语叫做集合(collection)，调用mongoose.model并传入第一个参数是model名，第二个是表的结构</span></span><br><span class="line"><span class="comment">//其中第二个参数作为表的结构使用mongoose.Schema定义，具体内容官网都有详细的文档。（比如数据类型之类的）</span></span><br><span class="line"><span class="comment">//第三个参数是集合名，省略的话默认会使用第一个参数的全小写的复数形式（所以这个例子写不写都一样）</span></span><br><span class="line"><span class="keyword">const</span> userSchema = mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">pwd</span>: <span class="title class_">String</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, userSchema, <span class="string">&#x27;users&#x27;</span>);</span><br><span class="line"><span class="comment">// const User = mongoose.model(&#x27;User&#x27;, userSchema); 和上面一行效果一样</span></span><br><span class="line"><span class="comment">// const User = mongoose.model(&#x27;User&#x27;, userSchema, &#x27;user&#x27;); 这么写集合名就是user了</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">User</span> = <span class="title class_">User</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//routes/user.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = <span class="built_in">require</span>(<span class="string">&#x27;../model/User&#x27;</span>).<span class="property">User</span>;</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="title class_">User</span>.<span class="title function_">findOne</span>(req.<span class="property">body</span>, <span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;数据库错误&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;登陆成功!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;账号或密码错误!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">    <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;<span class="string">&#x27;name&#x27;</span>: req.<span class="property">body</span>.<span class="property">name</span>&#125;, <span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;数据库错误&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&#x27;用户已存在&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//根据定义的model新建一个对象并保存，第二个参数是保存成功后的回调函数</span></span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(req.<span class="property">body</span>);</span><br><span class="line">            user.<span class="title function_">save</span>(<span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span><br><span class="line">                res.<span class="title function_">send</span>(<span class="string">&#x27;登陆成功!&#x27;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>到这里，前端后端数据库都连上了，代码也很清晰了。可以说我们的基础部分已经完成了。整个教程也到了尾声，本来打算介绍下测试，但是考虑到Angularjs即将被弃用就不打算再打一遍了，而Angular的cli配了一个开箱即用的测试框架，所以这部分内容以后写Angular相关的时候再详细介绍吧。至于开头说的time table这个项目，我是之前打过一遍的，功能也基本完整（还有测试相关代码）。这次写教程又根据文章节奏打了下，所以就到最简单的登录注册。并用commit记录内容。有心学习的同鞋可以去github的commit记录上一步步对照内容看下来。</p>
<hr>
<h1 id="项目代码"><a href="#项目代码" class="headerlink" title="项目代码"></a>项目代码</h1><ol>
<li>根据上面内容写的代码 <a href="https://github.com/dreamhuan/timetable">timetable</a></li>
<li>文初说的完整的项目代码 <a href="https://github.com/dreamhuan/timetable_fkq">timetable_fkq</a></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MEAN/" rel="tag"># MEAN</a>
              <a href="/tags/Nodejs/" rel="tag"># Nodejs</a>
              <a href="/tags/AngularJS/" rel="tag"># AngularJS</a>
              <a href="/tags/Express/" rel="tag"># Express</a>
              <a href="/tags/MongoDB/" rel="tag"># MongoDB</a>
              <a href="/tags/front-end/" rel="tag"># front-end</a>
              <a href="/tags/back-end/" rel="tag"># back-end</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/03/30/web-study/" rel="prev" title="web study">
      <i class="fa fa-chevron-left"></i> web study
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/11/15/%E5%AE%89%E5%8D%93%E8%B0%83%E8%AF%95%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="next" title="安卓调试数据库">
      安卓调试数据库 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E8%A7%88"><span class="nav-number">1.</span> <span class="nav-text">总览</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MEAN-js%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">MEAN.js简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A5%E4%B8%80%E4%B8%AA%E5%B0%8F%E9%A1%B9%E7%9B%AE%E4%B8%BA%E4%BE%8B"><span class="nav-number">1.2.</span> <span class="nav-text">以一个小项目为例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF"><span class="nav-number">2.</span> <span class="nav-text">后端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Nodejs%E5%BB%BA%E7%AB%8B%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">2.1.</span> <span class="nav-text">Nodejs建立服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">2.2.</span> <span class="nav-text">后端基本结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB"><span class="nav-number">2.3.</span> <span class="nav-text">前后端分离</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF"><span class="nav-number">3.</span> <span class="nav-text">前端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.</span> <span class="nav-text">前端基本结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AngularJS%EF%BC%9AMVC"><span class="nav-number">3.2.</span> <span class="nav-text">AngularJS：MVC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack%E7%9A%84%E5%8A%A0%E5%85%A5"><span class="nav-number">3.3.</span> <span class="nav-text">webpack的加入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.</span> <span class="nav-text">数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB%E7%AE%80%E4%BB%8B"><span class="nav-number">4.1.</span> <span class="nav-text">MongoDB简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="nav-number">4.2.</span> <span class="nav-text">MongoDB可视化工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mongoose%E5%BA%93%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.3.</span> <span class="nav-text">mongoose库介绍</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81"><span class="nav-number">5.</span> <span class="nav-text">项目代码</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dreamhuan"
      src="/images/dreamhuan.jpg">
  <p class="site-author-name" itemprop="name">dreamhuan</p>
  <div class="site-description" itemprop="description">萌新求带</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dreamhuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dreamhuan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:fu_kaiqi@qq.com" title="E-Mail → mailto:fu_kaiqi@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dreamhuan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"lRR7RSSE3REHSKHORbXabbjR-gzGzoHsz","app_key":"8yMQK4RGLR0tKJXe5eoKVOyF","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : 8026,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://dreamhuan.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://dreamhuan.github.io/2017/11/03/MEAN-stack%E7%9A%84%E7%82%B9%E7%82%B9%E6%BB%B4%E6%BB%B4/";
    this.page.identifier = "2017/11/03/MEAN-stack的点点滴滴/";
    this.page.title = "MEAN stack的点点滴滴";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://dreamhuan.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
